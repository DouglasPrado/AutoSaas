{
  "epic": {
    "title": "Autenticacao e Gestao de Usuarios",
    "description": "Sistema completo de autenticacao, registro e gestao de usuarios",
    "labels": ["epic", "core", "auth"]
  },
  "stories": [
    {
      "title": "Registro de Usuario",
      "description": "Como visitante, quero me registrar na plataforma para ter acesso ao sistema",
      "acceptance_criteria": [
        "Formulario com email e senha",
        "Validacao de email unico",
        "Senha com minimo 8 caracteres",
        "Email de confirmacao enviado",
        "Redirecionamento apos registro"
      ],
      "labels": ["story", "auth"],
      "tasks": [
        {
          "title": "Criar pagina de registro",
          "description": "Implementar UI do formulario de registro",
          "labels": ["task", "frontend"],
          "technical_details": {
            "stack": "Next.js 15+ App Router, TypeScript, React Hook Form, Zod",
            "files": [
              "app/(auth)/register/page.tsx",
              "components/auth/register-form.tsx",
              "lib/validations/auth.ts"
            ],
            "packages": ["react-hook-form", "zod", "@hookform/resolvers"],
            "implementation_notes": "Usar Server Actions para submit do form. Validar com Zod schema. Usar useFormState para loading states. Componentes de UI com shadcn/ui (Input, Button, Form)."
          }
        },
        {
          "title": "Implementar API de registro",
          "description": "Endpoint POST /api/auth/register",
          "labels": ["task", "backend"],
          "technical_details": {
            "stack": "Next.js API Routes/Server Actions, Prisma, bcrypt",
            "files": [
              "app/api/auth/register/route.ts",
              "lib/auth/register.ts",
              "prisma/schema.prisma"
            ],
            "packages": ["bcryptjs", "@types/bcryptjs"],
            "implementation_notes": "Criar modelo User no Prisma com campos: id, email, password, emailVerified, createdAt. Hash da senha com bcrypt (salt rounds: 12). Verificar email unico com prisma.user.findUnique. Retornar 409 se email existe."
          },
          "depends_on": ["[TASK] Criar pagina de registro"]
        },
        {
          "title": "Configurar envio de email de confirmacao",
          "description": "Integrar servico de email para confirmacao",
          "labels": ["task", "backend", "integration"],
          "technical_details": {
            "stack": "Resend ou NodeMailer, React Email",
            "files": [
              "lib/email/send.ts",
              "lib/email/templates/verify-email.tsx",
              "app/api/auth/verify/route.ts"
            ],
            "packages": ["resend", "@react-email/components"],
            "implementation_notes": "Usar Resend para envio (100 emails/dia gratis). Criar template com React Email. Gerar token de verificacao com crypto.randomUUID(), salvar em VerificationToken model do Prisma com expiracao de 24h. Rota GET /api/auth/verify?token=xxx para validar."
          },
          "depends_on": ["[TASK] Implementar API de registro"]
        },
        {
          "title": "Criar testes de registro",
          "description": "Testes unitarios e de integracao para fluxo de registro",
          "labels": ["task", "testing"],
          "technical_details": {
            "stack": "Vitest, Testing Library, MSW",
            "files": [
              "__tests__/auth/register.test.ts",
              "__tests__/components/register-form.test.tsx",
              "lib/test-utils.ts"
            ],
            "packages": [
              "vitest",
              "@testing-library/react",
              "@testing-library/user-event",
              "msw"
            ],
            "implementation_notes": "Testar: validacao de form, email duplicado retorna erro, senha fraca rejeitada, registro sucesso cria user no DB. Usar Prisma com banco de teste separado (TEST_DATABASE_URL)."
          },
          "depends_on": ["[TASK] Implementar API de registro"]
        }
      ]
    },
    {
      "title": "Login de Usuario",
      "description": "Como usuario registrado, quero fazer login para acessar minha conta",
      "acceptance_criteria": [
        "Login com email e senha",
        "Opcao 'Lembrar-me'",
        "Mensagem de erro clara para credenciais invalidas",
        "Redirecionamento para dashboard apos login"
      ],
      "labels": ["story", "auth"],
      "depends_on": ["Registro de Usuario"],
      "tasks": [
        {
          "title": "Criar pagina de login",
          "description": "Implementar UI do formulario de login",
          "labels": ["task", "frontend"],
          "technical_details": {
            "stack": "Next.js App Router, NextAuth.js, React Hook Form, Zod",
            "files": [
              "app/(auth)/login/page.tsx",
              "components/auth/login-form.tsx",
              "lib/validations/auth.ts"
            ],
            "packages": ["next-auth", "react-hook-form", "zod"],
            "implementation_notes": "Usar signIn() do NextAuth com redirect: false para tratar erros. Checkbox 'Lembrar-me' ajusta maxAge do session. Mostrar toast de erro com sonner. Redirect para callbackUrl ou /dashboard."
          }
        },
        {
          "title": "Implementar API de login",
          "description": "Endpoint POST /api/auth/login com JWT",
          "labels": ["task", "backend"],
          "technical_details": {
            "stack": "NextAuth.js v5, Prisma Adapter, bcrypt",
            "files": [
              "auth.ts",
              "app/api/auth/[...nextauth]/route.ts",
              "lib/auth/config.ts"
            ],
            "packages": ["next-auth", "@auth/prisma-adapter"],
            "implementation_notes": "Configurar NextAuth com CredentialsProvider. Usar PrismaAdapter para sessoes no DB. Validar senha com bcrypt.compare(). Callback jwt para adicionar userId ao token. Callback session para expor user.id no client."
          },
          "depends_on": ["[TASK] Criar pagina de login"]
        },
        {
          "title": "Implementar persistencia de sessao",
          "description": "Cookies httpOnly e refresh token",
          "labels": ["task", "backend"],
          "technical_details": {
            "stack": "NextAuth.js, Prisma",
            "files": ["auth.ts", "middleware.ts", "lib/auth/session.ts"],
            "packages": ["next-auth"],
            "implementation_notes": "NextAuth gerencia cookies httpOnly automaticamente. Configurar session strategy: 'jwt' para stateless ou 'database' para sessoes no Prisma. Middleware.ts protege rotas /dashboard/*. Helper auth() para Server Components."
          },
          "depends_on": ["[TASK] Implementar API de login"]
        }
      ]
    },
    {
      "title": "Recuperacao de Senha",
      "description": "Como usuario, quero recuperar minha senha caso esqueca",
      "acceptance_criteria": [
        "Solicitar recuperacao por email",
        "Link de recuperacao com expiracao de 1h",
        "Formulario para definir nova senha",
        "Confirmacao de alteracao"
      ],
      "labels": ["story", "auth"],
      "depends_on": ["Login de Usuario"],
      "tasks": [
        {
          "title": "Criar pagina de recuperacao de senha",
          "description": "UI para solicitar e redefinir senha",
          "labels": ["task", "frontend"],
          "technical_details": {
            "stack": "Next.js App Router, React Hook Form, Zod",
            "files": [
              "app/(auth)/forgot-password/page.tsx",
              "app/(auth)/reset-password/page.tsx",
              "components/auth/forgot-password-form.tsx",
              "components/auth/reset-password-form.tsx"
            ],
            "packages": ["react-hook-form", "zod"],
            "implementation_notes": "Duas paginas: /forgot-password (solicitar) e /reset-password?token=xxx (redefinir). Validar token no Server Component antes de mostrar form. Usar Server Actions para submit."
          }
        },
        {
          "title": "Implementar API de recuperacao",
          "description": "Endpoints para solicitar e redefinir senha",
          "labels": ["task", "backend"],
          "technical_details": {
            "stack": "Next.js Server Actions, Prisma, Resend",
            "files": [
              "lib/actions/auth/forgot-password.ts",
              "lib/actions/auth/reset-password.ts",
              "lib/email/templates/reset-password.tsx"
            ],
            "packages": ["resend", "@react-email/components"],
            "implementation_notes": "Gerar token com crypto.randomBytes(32).toString('hex'). Salvar hash do token no PasswordResetToken model com expiracao 1h. Enviar email com link. Na redefinicao, validar token, hash nova senha, deletar token usado."
          },
          "depends_on": ["[TASK] Criar pagina de recuperacao de senha"]
        },
        {
          "title": "Implementar token de recuperacao",
          "description": "Gerar e validar token temporario",
          "labels": ["task", "backend"],
          "technical_details": {
            "stack": "Node.js crypto, Prisma",
            "files": ["lib/auth/tokens.ts", "prisma/schema.prisma"],
            "packages": [],
            "implementation_notes": "Model PasswordResetToken: id, email, token (hashed), expires. Funcoes: generatePasswordResetToken(email), getPasswordResetTokenByToken(token), deletePasswordResetToken(id). Hash token antes de salvar para seguranca."
          },
          "depends_on": ["[TASK] Implementar API de recuperacao"]
        }
      ]
    },
    {
      "title": "Login Social (OAuth)",
      "description": "Como usuario, quero fazer login usando minhas redes sociais",
      "acceptance_criteria": [
        "Login com Google",
        "Login com GitHub",
        "Criar conta automaticamente se nao existir",
        "Vincular conta social a conta existente"
      ],
      "labels": ["story", "auth", "enhancement"],
      "depends_on": ["Login de Usuario"],
      "tasks": [
        {
          "title": "Configurar OAuth Google",
          "description": "Integrar Google OAuth 2.0",
          "labels": ["task", "backend", "integration"],
          "technical_details": {
            "stack": "NextAuth.js, Google Provider",
            "files": ["auth.ts", "lib/auth/config.ts"],
            "packages": ["next-auth"],
            "implementation_notes": "Adicionar GoogleProvider no NextAuth. Configurar GOOGLE_CLIENT_ID e GOOGLE_CLIENT_SECRET no .env. Callback URL: /api/auth/callback/google. No Google Console: criar OAuth 2.0 credentials, adicionar redirect URI."
          }
        },
        {
          "title": "Configurar OAuth GitHub",
          "description": "Integrar GitHub OAuth",
          "labels": ["task", "backend", "integration"],
          "technical_details": {
            "stack": "NextAuth.js, GitHub Provider",
            "files": ["auth.ts", "lib/auth/config.ts"],
            "packages": ["next-auth"],
            "implementation_notes": "Adicionar GitHubProvider no NextAuth. Configurar GITHUB_CLIENT_ID e GITHUB_CLIENT_SECRET. No GitHub: Settings > Developer settings > OAuth Apps. Callback URL: /api/auth/callback/github."
          },
          "depends_on": ["[TASK] Configurar OAuth Google"]
        },
        {
          "title": "Criar botoes de login social",
          "description": "UI para opcoes de login social",
          "labels": ["task", "frontend"],
          "technical_details": {
            "stack": "Next.js, NextAuth.js, Lucide React",
            "files": [
              "components/auth/social-buttons.tsx",
              "components/auth/login-form.tsx"
            ],
            "packages": ["lucide-react"],
            "implementation_notes": "Componente SocialButtons com botoes Google e GitHub. Usar signIn('google') e signIn('github') do NextAuth. Icones do Lucide. Separador 'ou' entre form e social. Loading state durante redirect."
          },
          "depends_on": ["[TASK] Configurar OAuth GitHub"]
        }
      ]
    },
    {
      "title": "Autenticacao de Dois Fatores (2FA)",
      "description": "Como usuario, quero habilitar 2FA para maior seguranca",
      "acceptance_criteria": [
        "Configurar 2FA com app autenticador",
        "Gerar codigos de backup",
        "Solicitar codigo no login quando ativo",
        "Opcao de desabilitar 2FA"
      ],
      "labels": ["story", "auth", "security"],
      "depends_on": ["Login de Usuario"],
      "tasks": [
        {
          "title": "Implementar TOTP",
          "description": "Gerar e validar codigos TOTP",
          "labels": ["task", "backend"],
          "technical_details": {
            "stack": "otpauth, Prisma",
            "files": [
              "lib/auth/two-factor.ts",
              "lib/actions/auth/enable-2fa.ts",
              "lib/actions/auth/verify-2fa.ts",
              "prisma/schema.prisma"
            ],
            "packages": ["otpauth", "qrcode"],
            "implementation_notes": "Usar otpauth para gerar secret TOTP. Salvar secret encriptado no User model (twoFactorSecret). Funcao generateTOTP() cria URI otpauth://. Funcao verifyTOTP(token, secret) valida codigo de 6 digitos. Window de 1 para tolerancia de tempo."
          }
        },
        {
          "title": "Criar UI de configuracao 2FA",
          "description": "QR code e input de verificacao",
          "labels": ["task", "frontend"],
          "technical_details": {
            "stack": "Next.js, QRCode, React Hook Form",
            "files": [
              "app/(dashboard)/settings/security/page.tsx",
              "components/settings/two-factor-setup.tsx",
              "components/auth/two-factor-verify.tsx"
            ],
            "packages": ["qrcode", "@types/qrcode"],
            "implementation_notes": "Mostrar QR code com qrcode.toDataURL(otpauthUri). Input de 6 digitos com auto-focus entre campos. Modal de confirmacao antes de habilitar. Mostrar codigos de backup apos ativar (uma unica vez)."
          },
          "depends_on": ["[TASK] Implementar TOTP"]
        },
        {
          "title": "Gerar codigos de backup",
          "description": "Criar e armazenar codigos de recuperacao",
          "labels": ["task", "backend"],
          "technical_details": {
            "stack": "Node.js crypto, Prisma",
            "files": ["lib/auth/backup-codes.ts", "prisma/schema.prisma"],
            "packages": [],
            "implementation_notes": "Gerar 10 codigos de 8 caracteres com crypto.randomBytes(4).toString('hex'). Salvar hash bcrypt de cada codigo no model BackupCode. Ao usar codigo, deletar do DB. Mostrar codigos apenas uma vez ao usuario."
          },
          "depends_on": ["[TASK] Implementar TOTP"]
        }
      ]
    }
  ]
}
